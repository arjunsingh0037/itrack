define(["jquery"],function(a){function b(){a("textarea.edit_code").each(d)}function c(b){a(document.getElementById(b)).each(d)}function d(){var b=9,c=13,d=27,f=77;a(this).data("clickInProgress",!1),a(this).data("capturingTab",!0),a(this).on("mousedown",function(){a(this).data("clickInProgress",!0)}),a(this).on("focusin",function(){a(this).data("capturingTab",a(this).data("clickInProgress"))}),a(this).on("click",function(){a(this).data("clickInProgress",!1)}),a(this).on("keydown",function(g){if(!(window.hasOwnProperty("behattesting")&&window.behattesting||void 0!==g.which&&0===g.which))if(g.keyCode==b&&a(this).data("capturingTab"))(g.shiftKey||e(this,"    "))&&g.preventDefault();else if(g.keyCode===c&&void 0!==this.selectionStart){for(var h=this.value.substring(0,this.selectionStart),i=h.lastIndexOf("\n"),j=h.substring(i+1),k="",l=0;l<j.length&&" "===j.charAt(l);l++)k+=" ";e(this,"\n"+k)&&g.preventDefault(),a(this).data("capturingTab",!0)}else g.keyCode===f&&g.ctrlKey&&!g.altKey?(a(this).data("capturingTab",!a(this).data("capturingTab")),g.preventDefault()):g.keyCode===d?a(this).data("capturingTab",!1):g.ctrlKey||g.altKey||a(this).data("capturingTab",!0)})}function e(a,b){if(void 0!==a.selectionStart){var c=a.value.substring(0,a.selectionStart),d=a.selectionEnd,e=a.value.substring(a.selectionEnd,a.value.length),f=a.scrollTop;a.value=c+b+e;var g=d+b.length;return a.selectionStart=g,a.selectionEnd=g,a.scrollTop=f,!0}if(document.selection&&document.selection.createRange){var h=document.selection.createRange(),i=h.duplicate();return i.moveToElementText(a),i.setEndPoint("EndToEnd",h),h.text=b,!0}return!1}return{setupAllTAs:b,initQuestionTA:c}});