window.opener||("undefined"==typeof wwwroot&&(wwwroot=""),require.config({baseUrl:wwwroot+"local/vmchat/bundle/chat/",paths:{"bundle/io/build/iolib":"bundle/io/build/iolib"},waitSeconds:0}),define(["jquery","jqueryui","bundle/io/build/iolib","build/lang.en","build/chatboxManager","build/lib","build/window","build/footer","build/uichatlist","build/uichatbox","build/uichatroom"],function(a,b,c,d,e,f,g){return{init:function(b){var h="myCss";if(!document.getElementById(h)){var i=document.getElementsByTagName("head")[0],j=document.createElement("link");j.id=h,j.rel="stylesheet",j.type="text/css",j.href=b+"local/vmchat/bundle/chat/bundle/jquery/css/base/jquery-ui.css",j.media="all",i.appendChild(j)}var h="myCss1";if(!document.getElementById(h)){var i=document.getElementsByTagName("head")[0],j=document.createElement("link");j.id=h,j.rel="stylesheet",j.type="text/css",j.href=b+"local/vmchat/bundle/chat/css/jquery.ui.chatbox.css",j.media="all",i.appendChild(j)}a.uiBackCompat=!1;var k={userid:id,name:fname,lname:lname,img:imageurl},l=tk+"-main-c-room";dataobject={userid:id,sid:sid,rid:path,authuser:auth_user,authpass:auth_pass,userobj:k,room:l},a(document).ready(function(){counter=0,idList=new Array;return a.htab=[],a.htabIndex=[],vmstorage={},0==f.browserSupportsLocalStorage()?void f.display_error(d.sterror):("false"!=localStorage.getItem("init")&&c.init(dataobject),a("body").footerbar(),"false"==localStorage.getItem("init")&&(a("#stickybar").removeClass("maximize").addClass("minimize"),a("#hide_bar input").removeClass("close").addClass("expand")),tabs=a("#tabs").tabs({cache:!0,activeOnAdd:!0}),null!=localStorage.getItem(sid)&&(f.displayChatHistory(),vmstorage=JSON.parse(localStorage.getItem(sid))),sessionStorage.length>0&&null!=sessionStorage.getItem("chatroom")&&f.displaycomChatHistory(),a("#tabs").delegate("span.ui-icon-close","click",function(){var b=a(this).closest("li").attr("id").substring(5);a("#"+b).chatbox("option").boxClosed(b),a("div#cb"+b+".ui-widget").hide();var c=a(this).closest("li").remove().attr("aria-controls");a("#"+c).remove(),delete vmstorage[b]}),a("#tabs").on("click","li a",function(){var b=a(this).closest("li").attr("id").substring(5);a("#"+b).chatbox("toggleContentbox"),"hidden"==localStorage.getItem(b)?localStorage.removeItem(b):localStorage.setItem(b,"hidden")}),a("ul.tabs").on("click","li",function(){a("li[aria-controls = '"+a(this).attr("id")+"']").removeClass("ui-state-highlight")}),a(document).on("member_added",function(a){f.memberUpdate(a)}),a(document).on("member_removed",function(a){f.memberUpdate(a)}),a(document).on("newmessage",function(a){f.messageUpdate(a)}),a(document).on("Multiple_login",function(b){a(".ui-memblist").remove(),a(".ui-chatbox").remove(),a("div#chatrm").remove(),chatroombox=null;for(key in c.uniquesids)key!=c.cfg.userid&&(e.delBox(key),a("li#tabcb"+key).remove());idList=new Array,a("#stickybar").removeClass("maximize").addClass("minimize"),a("#hide_bar input").removeClass("close").addClass("expand"),a("#hide_bar input").prop("title","Open chat"),tabs.tabs("refresh")}),a(document).on("authentication_failed",function(a){document.cookie="auth_user=; expires=Thu, 01 Jan 1970 00:00:00 GMT; path=/",document.cookie="auth_pass=; expires=Thu, 01 Jan 1970 00:00:00 GMT; path=/",document.cookie="path=; expires=Thu, 01 Jan 1970 00:00:00 GMT; path=/",f.display_error(a.message)}),a(document).on("error",function(a){"object"!=typeof a.message&&f.display_error(a.message)}),a(document).on("connectionclose",function(c){a("#user_list .inner_bt #usertab_icon").css({background:"url("+b+"local/vmchat/bundle/chat/images/offline.png)no-repeat top left"}),a("#user_list .inner_bt #usertab_text").text(d.whos+" (0)"),a("#chatroom_bt .inner_bt #chatroom_text").text(d.chatroom+" (0)"),a("div#memlist").css("display","none")}),void(f.isIosDevices()?a(g).unload(function(){var a=JSON.stringify(vmstorage);localStorage.setItem(sid,a)}):a(g).bind("beforeunload",function(){var a=JSON.stringify(vmstorage);localStorage.setItem(sid,a)})))})}}}));