define(["jquery","jqueryui","build/chatboxManager"],function(a,b,c){a.widget("ui.memberlist",{options:{id:null,title:null,user:null,hidden:!1,offset:0,width:230,userSent:function(a){this.boxManager.addUsr(a.name)},boxClosed:function(a){},boxManager:{init:function(a){this.elem=a},addUsr:function(b){var c=this,d=c.elem.uiChatboxLog,e=document.createElement("div");d.append(e);var f=!1;if(b){var g=document.createElement("a");g.href="#"+b.userid;var h=document.createElement("img");h.src=b.img,g.appendChild(h);var i=document.createElement("span");void 0==b.lname&&(b.lname=""),a(i).text(b.name+" "+b.lname),g.appendChild(i),e.appendChild(g)}else f=!0;a(e).addClass("ui-memblist-usr"),a(e).attr("id","ml"+b.userid),a(e).fadeIn(),c._scrollToBottom()},highlightBox:function(){var a=this;a.elem.uiChatboxTitlebar.effect("highlight",{},300),a.elem.uiChatbox.effect("bounce",{times:3},300,function(){a.highlightLock=!1,a._scrollToBottom()})},toggleBox:function(){this.elem.uiChatbox.toggle("slide",{direction:"down"},1e3)},_scrollToBottom:function(){var a=this.elem.uiChatboxLog;a.scrollTop(a.get(0).scrollHeight)}}},toggleContent:function(a){this.uiChatboxContent.toggle(),this.uiChatboxContent.is(":visible")},widget:function(){return this.uiChatbox},_create:function(){var b=this,d=b.options,e=(d.offset,d.title||"No Title"),f=(b.uiChatbox=a("<div></div>")).appendTo(document.body).addClass("ui-widget ui-corner-top ui-memblist").attr("id","memlist").attr("outline",0).css("display","none").focusin(function(){b.uiChatboxTitlebar.addClass("ui-state-focus")}).focusout(function(){b.uiChatboxTitlebar.removeClass("ui-state-focus")}),g=(b.uiChatboxTitlebar=a("<div></div>")).addClass("ui-widget-header ui-corner-top ui-memblist-titlebar ui-dialog-header").click(function(a){}).appendTo(f),h=((b.uiChatboxTitle=a("<span></span>")).html(e).appendTo(g),(b.uiChatboxTitlebarClose=a('<a href="#"></a>')).addClass("ui-corner-all ui-memblist-icon ").attr("role","button").hover(function(){h.addClass("ui-state-hover")},function(){h.removeClass("ui-state-hover")}));uiChatboxTitlebarMinimize=(b.uiChatboxTitlebarMinimize=a('<a href="#"></a>')).addClass("ui-corner-all ui-memblist-icon").attr("role","button").hover(function(){uiChatboxTitlebarMinimize.addClass("ui-state-hover")},function(){uiChatboxTitlebarMinimize.removeClass("ui-state-hover")}).click(function(b){return a("#chat_div").memberlist("option","boxManager").toggleBox(),!1}).appendTo(g),uiChatboxTitlebarMinimizeText=a("<span></span>").addClass("ui-icon ui-icon-minusthick").text("minimize").appendTo(uiChatboxTitlebarMinimize),uiChatboxContent=(b.uiChatboxContent=a("<div></div>")).addClass("ui-widget-content ui-memblist-content ").appendTo(f),uiChatboxLog=(b.uiChatboxLog=b.element).addClass("ui-widget-content ui-memblist-log").appendTo(uiChatboxContent).focusin(function(){var b=a(this).parent().prev();b.scrollTop(b.get(0).scrollHeight)}),g.find("*").add(g).disableSelection(),a(document).on("click","#chat_div .ui-memblist-usr a",function(b){var d=a(this),e=d.attr("href").replace("#",""),f=d.find("span").html();a.inArray(e,idList)==-1&&(counter++,idList.push(e),vmstorage[e]=[],vmstorage[e].push({userid:e,name:f})),c.addBox(e,{dest:"dest"+counter,title:"box"+counter,first_name:f}),c.init({user:{name:f},messageSent:function(b,c,d){a("#"+b).chatbox("option","boxManager").addMsg(c.name,d)}}),e=null,f=null}),b._setWidth(b.options.width),b._position(b.options.offset),b.options.boxManager.init(b)},_setOption:function(b,c){if(null!=c)switch(b){case"hidden":c?this.uiChatbox.hide():this.uiChatbox.show();break;case"offset":this._position(c);break;case"width":this._setWidth(c)}a.Widget.prototype._setOption.apply(this,arguments)},_setWidth:function(a){this.uiChatboxTitlebar.width(a+"px"),this.uiChatboxLog.width(a+"px")},_position:function(a){this.uiChatbox.css("right",a)}})});